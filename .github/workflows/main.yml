name: Setup Animate Diff Environment

on:
  push:
    branches: [main]

jobs:
  environment-test:
    runs-on: ubuntu-latest
    services:
      nvidia-gpu:
        image: nvidia/cuda:11.7-devel-ubuntu20.04
        
    steps:
    - uses: actions/checkout@v4
    
    - name: GPU Check
      run: nvidia-smi
        
    - name: Install Animate Diff
      run: |
        git clone https://github.com/guoyww/AnimateDiff.git
        cd AnimateDiff
        pip install -r requirements.txt
        pip install git+https://github.com/guoyww/AnimateDiff.git
        
    - name: Test basic functionality
      run: |
        python -c "
import torch
from animatediff import AnimateDiffPipeline
print('Animate Diff installed successfully!')
        "
